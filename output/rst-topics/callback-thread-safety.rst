Callback thread safety
----------------------

Make sure the code is threadsafe, because the callbacks can be triggered from different threads.

