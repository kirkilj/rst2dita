<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.12 -->
<document source="C:\DITA\rst2dita\source\rst\abc-sdk.rst">
    <section ids="introduction" names="introduction">
        <title>Introduction</title>
        <section ids="product-information" names="product\ information">
            <title>Product information</title>
            <paragraph>The ABC-Test SDK is a stand-alone, cross-platform, static library, which you can use to communicate to the Cloud.</paragraph>
            <paragraph>The SDK is mainly written in C.</paragraph>
            <paragraph>You can find the latest revision of the SDK at: <reference name="si.abc.com" refuri="http://si.abc.com">si.abc.com</reference><target ids="si-abc-com" names="si.abc.com" refuri="http://si.abc.com"></target></paragraph>
        </section>
        <section ids="system-requirements" names="system\ requirements">
            <title>System requirements</title>
            <paragraph>Supported operating systems:</paragraph>
            <table>
                <tgroup cols="3">
                    <colspec colwidth="9">
                    </colspec>
                    <colspec colwidth="9">
                    </colspec>
                    <colspec colwidth="9">
                    </colspec>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>OS</paragraph>
                            </entry>
                            <entry>
                                <paragraph>x86</paragraph>
                            </entry>
                            <entry>
                                <paragraph>x86_64</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>Windows</paragraph>
                            </entry>
                            <entry>
                                <paragraph>✓</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>Linux</paragraph>
                            </entry>
                            <entry>
                                <paragraph>✓</paragraph>
                            </entry>
                            <entry>
                                <paragraph>✓</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>MacOS X</paragraph>
                            </entry>
                            <entry>
                            </entry>
                            <entry>
                                <paragraph>✓</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="third-party-libraries" names="third-party\ libraries">
            <title>Third-party libraries</title>
            <paragraph>Depending on the platform, the following third-party libraries are used by ABC-Test SDK.</paragraph>
            <table>
                <tgroup cols="3">
                    <colspec colwidth="25">
                    </colspec>
                    <colspec colwidth="25">
                    </colspec>
                    <colspec colwidth="25">
                    </colspec>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>Library</paragraph>
                            </entry>
                            <entry>
                                <paragraph>License</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Version</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>Apache APR</paragraph>
                            </entry>
                            <entry>
                                <paragraph>APACHE</paragraph>
                            </entry>
                            <entry>
                                <paragraph>1.4.5</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>Apache APR-UTIL</paragraph>
                            </entry>
                            <entry>
                                <paragraph>APACHE</paragraph>
                            </entry>
                            <entry>
                                <paragraph>1.3.12</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>bzlib2</paragraph>
                            </entry>
                            <entry>
                                <paragraph>PUBLIC</paragraph>
                            </entry>
                            <entry>
                                <paragraph>1.0.6</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>libcurl</paragraph>
                            </entry>
                            <entry>
                                <paragraph>PUBLIC DOMAIN</paragraph>
                            </entry>
                            <entry>
                                <paragraph>7.25.1</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>libcares</paragraph>
                            </entry>
                            <entry>
                                <paragraph>MIT</paragraph>
                            </entry>
                            <entry>
                                <paragraph>1.7.5</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>protobuf</paragraph>
                            </entry>
                            <entry>
                                <paragraph>BSD</paragraph>
                            </entry>
                            <entry>
                                <paragraph>2.3.0</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>stlport</paragraph>
                            </entry>
                            <entry>
                                <paragraph>PUBLIC DOMAIN</paragraph>
                            </entry>
                            <entry>
                                <paragraph>5.2.1</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>openssl</paragraph>
                            </entry>
                            <entry>
                                <paragraph>PUBLIC</paragraph>
                            </entry>
                            <entry>
                                <paragraph>1.0.1c</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="sdk-archive-structure" names="sdk\ archive\ structure">
            <title>SDK archive structure</title>
            <paragraph>The SDK is organized in a standard structure.</paragraph>
            <definition_list>
                <definition_list_item>
                    <term><strong>bin</strong></term>
                    <definition>
                        <paragraph>.dll files on Windows platforms, along with the SSL certificate used to validate the identity of our servers (cacert.crt )</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term><strong>docs</strong></term>
                    <definition>
                        <paragraph>Documentation for the SDK.</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term><strong>include</strong></term>
                    <definition>
                        <paragraph>C headers used to compile applications using the SDK.</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term><strong>lib</strong></term>
                    <definition>
                        <paragraph>.lib files on Windows platforms (used for linking applications), or shared libraries on Unix-like platforms.</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term><strong>licenses</strong></term>
                    <definition>
                        <paragraph>Licenses for all the third-party libraries used by the SDK.</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term><strong>src</strong></term>
                    <definition>
                        <paragraph>The SDK demo application.</paragraph>
                    </definition>
                </definition_list_item>
            </definition_list>
        </section>
        <section ids="compiling-the-sample-application" names="compiling\ the\ sample\ application">
            <title>Compiling the sample application</title>
            <paragraph>The SDK contains a sample application, to demonstrate its basic usage, for example, to check the status of a file with the cloud and to upload it, if needed.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Edit the file <strong>src/file_demo_sdk.c</strong> , by replacing the define values with the ones provided to you by ABC.</paragraph>
                </list_item>
            </bullet_list>
            <literal_block xml:space="preserve">#define ABC_SDK_PRODUCT_ID 0
#define ABC_SDK_PRODUCT_LICENSE "-md5-sum-license-here-"
#define ABC_SDK_SERVICE_ADDRESS "https://auth.abc.com/"</literal_block>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Compile the application using the <strong>.sln</strong> file (for Visual Studio 2010) or the <strong>Makefile</strong> (for UNIX platforms) in the <strong>src</strong> folder.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>The executable is created in the <strong>bin</strong> folder.</paragraph>
        </section>
        <section ids="possible-workflow" names="possible\ workflow">
            <title>Possible workflow</title>
            <paragraph>The diagram below provides a possible, simple workflow for working with the SDK.</paragraph>
            <image uri="workflow.png">
            </image>
            <paragraph>The first step is to scan a file, or a series of files and, maybe, upload those unknown. For each of them, a status callback function is called, containing data like <strong>category</strong> and <strong>status</strong> . The next step is to check the <strong>status</strong> .</paragraph>
            <paragraph>Possible status values:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph><strong>OK</strong> - The file has been analized and the <strong>category</strong> parameter shows the file’s category. Having an <strong>UNKNOWN</strong> category can indicate an error on the server side, but it does not imply any action from the client. This step is followed by the <strong>YES</strong> and <strong>NO</strong> branch cases (depending on the category).</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>IN_PROGRESS</strong> - The file has been uploaded by someone and it is in the process of being analyzed. The SDK user should call the check file/ hash function again, preferably after <strong>ttl</strong> seconds. This case is not drawn on the flowchart, for simplicity’s sake.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>UPLOAD</strong> - The server signals the SDK to upload the file. This is the <literal>UPLOAD callback</literal> branch. The SDK will invoke the <literal>upload init</literal> callback (no intervention needed).</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Once the file has been uploaded, the <literal>upload finished</literal> callback is triggered. If an error occurs, the user can be informed that the category is <strong>UNKNOWN</strong> . If the ticket expired, the entire scan request has to run from the top again, for a number of times. If the upload finished successfully, then a repeated check of this file should be performed, up to a number of times.</paragraph>
        </section>
    </section>
    <section ids="using-the-abc-test-sdk" names="using\ the\ abc-test\ sdk">
        <title>Using the ABC-Test SDK</title>
        <section ids="initializing-the-abc-test-sdk" names="initializing\ the\ abc-test\ sdk">
            <title>Initializing the ABC-Test SDK</title>
            <paragraph>In an application's lifetime, you need to initialize and uninitialize the ABC-Test SDK only once.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Before beginning to use the SDK, call the initialization function <literal>abc_file_initialize()</literal> .</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>If you don't initialize the SDK, most functions return an error code, except for <literal>abc_enable_log()</literal> .</paragraph>
        </section>
        <section ids="uninitializing-the-abc-test-sdk" names="uninitializing\ the\ abc-test\ sdk">
            <title>Uninitializing the ABC-Test SDK</title>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>To shut down the library, call the uninitialization function <literal>abc_file_uninitialize()</literal> .</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>You cannot use the library after uninitialization.</paragraph>
        </section>
        <section ids="creating-a-context" names="creating\ a\ context">
            <title>Creating a context</title>
            <paragraph>To create a connection to our ABC-Test service for online queries, you have to create and initialize a context containing internal state data.</paragraph>
            <warning>
                <paragraph>The contexts are not thread-safe. Do not use them for multiple threads simultaneously. Create a context for each thread you use in your application.</paragraph>
            </warning>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Call <literal>abc_create_context()</literal> to create a context.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Call <literal>abc_file_initialize_context()</literal> to start using the context.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>When you don't need the context any longer, call <literal>abc_file_uninitialize_context()</literal> , then <literal>abc_destroy_context()</literal> .</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>An error will occur, if you don't call the functions in this order.</paragraph>
        </section>
        <section ids="configuration" names="configuration">
            <title>Configuration</title>
            <paragraph>The API provides functions for global settings, which are used by existing and new contexts:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Setting a proxy</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Using proxy credentials (user, password)</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Setting the connection and data timeout</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Using an SSL CA certificate</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="callbacks" names="callbacks">
            <title>Callbacks</title>
            <paragraph>The ABC-Test SDK uses a callback mechanism to report and retrive information related to the actual analysing task from the application. These callbacks are functions which allow the application to perfom online lookups, taking a structure of function pointers as parameter.</paragraph>
            <paragraph>None of these callbacks is mandatory. If you do not set any callback, the queries will be performed, but you will not receive any notifications about the events.</paragraph>
            <warning>
                <paragraph>If you have multiple threads and set the same callback function inside your application, make sure the function is thread safe, since it will be called from different threads simultaneously.</paragraph>
            </warning>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph><literal>abc_file_error_cb</literal> - The error callback, triggered when a file error occurs (for example when reading or opening a file).</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>abc_file_hash_status_cb</literal> - The status callback, triggered to report the online status of a file/ hash (from the cloud).</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>abc_file_upload_init_cb</literal> - The upload init callback, triggered to ask if the user agrees with uploading a file, and to pass some more information about it, if available.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>abc_file_upload_start_cb</literal> - The upload start callback, triggered when the upload is starting (called from a different thread).</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>abc_file_upload_progress_cb</literal> - The upload progress callback, triggered to signal the upload progress (called from a different thread).</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>abc_file_upload_finish_cb</literal> - The upload finish callback, triggered to signal that an upload has finished (called from a different thread).</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="cloud-queries" names="cloud\ queries">
            <title>Cloud queries</title>
            <paragraph>The SDK provides functions which can query for one or multiple files/ hashes online. The query functions are synchronous and they block program execution until all the results are available.</paragraph>
            <warning>
                <paragraph>If the SDK is 32-bit and runs under Windows x64, you will encounter an issue where the OS redirects the access to certain locations, so you will not be able to access parts of the filesystem. See <reference name="Wow64" refid="wow64">Wow64</reference>  .</paragraph>
            </warning>
            <note>
                <paragraph>When looking up multiple files/ hashes:</paragraph>
            </note>
            <paragraph>Before the functions return to the caller, some of the callbacks are called, with the results for each file/ hash.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>An online query by hash(es) triggers the <literal>abc_file_hash_status_cb</literal> callbacks until the function exits.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>An online query by file(es) triggers the <literal>abc_file_hash_status_cb</literal> callbacks and eventually <literal>abc_file_fs_error_cb</literal> and <literal>abc_file_upload_init_cb</literal> .</paragraph>
                </list_item>
                <list_item>
                    <paragraph>In case the user accepts the upload, a newly created thread triggers the callbacks <literal>abc_file_upload_start_cb</literal> , <literal>abc_file_upload_progress_cb</literal> and <literal>abc_file_upload_finish_cb</literal> .</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="file-uploads" names="file\ uploads">
            <title>File uploads</title>
            <paragraph>Two API functions can be used to indicate if the SDK application agrees to upload files to the cloud or not: <literal>abc_file_willing_to_upload()</literal> and <literal>abc_file_unwilling_to_upload()</literal> . The reason for this is the following: uploading files to the cloud is not triggered by the application, but by the cloud. This is done via a special ticket, which is attached to the reply for a hash. When the SDK receives the ticket, it triggers the <literal>abc_file_upload_init_cb</literal> callback. After the application accepts, the file is added to an upload queue and sent to the cloud.</paragraph>
            <warning>
                <paragraph>If you do not set upload callbacks, the SDK behaves as if the ticket had been called.</paragraph>
            </warning>
            <paragraph><strong>Managing the process scan</strong></paragraph>
            <paragraph>There is a fixed number of threads which upload files to the cloud. Due to bandwidth limits, files can pile up in the upload queue, and the last ones can even get upload errors because their upload tickets will actually expire by the time they actually get processed. In order to avoid errors, you must manage the scan process from outside the SDK.</paragraph>
            <paragraph><strong>Solution #1:</strong> Feed the SDK tiny batches of files, and if there are uploads, wait until they are completed before continuing with the scan. This solution has the disadvantage of finishing the initial scan slower, because of the waiting for uploads.</paragraph>
            <paragraph><strong>Solution #2:</strong> Use <literal>abc_file_unwilling_to_upload()</literal> , which makes the SDK return the status <strong>UPLOAD</strong> on the <literal>abc_file_hash_status_cb</literal> , but not actually trigger the upload callback and the actual upload. The application using the SDK can then keep track of all the files which received this status and perform a second pass after calling <literal>abc_file_willing_to_upload()</literal> . Note that not all files might be requested for upload again (for example, if someone else uploaded a file in the mean time).</paragraph>
        </section>
    </section>
    <section ids="tips-and-tricks" names="tips\ and\ tricks">
        <title>Tips and tricks</title>
        <section ids="memory-handling" names="memory\ handling">
            <title>Memory handling</title>
            <paragraph>In the rare case of an out-of-memory error, the default behaviour is for the SDK to abort program execution: <literal>abort()</literal> . However, the user can set a different out-of-memory handling function which does not have the same behaviour.</paragraph>
        </section>
        <section ids="callback-thread-safety" names="callback\ thread\ safety">
            <title>Callback thread safety</title>
            <paragraph>Make sure the code is threadsafe, because the callbacks can be triggered from different threads.</paragraph>
        </section>
        <section ids="proxy-usage" names="proxy\ usage">
            <title>Proxy usage</title>
            <paragraph>In UNIX environments, the <strong>curl</strong> library respects the <strong>http(s)_proxy</strong> variables by default, if set. If you want a different behaviour, you need to explicitely disable the proxy by calling the <literal>abc_set_proxy</literal> function with an empty string as proxy address.</paragraph>
        </section>
        <section ids="ssl" names="ssl">
            <title>SSL</title>
            <paragraph>When using the SSL support, call <literal>abc_ssl_threads_initialize()</literal> prior to initializing the library and <literal>abc_ssl_threads_uninitialize()</literal> after uninitializing it.</paragraph>
        </section>
        <section ids="wow64" names="wow64">
            <title>Wow64</title>
            <paragraph>If running a 32-bit SDK on Windows x64, the OS performs automatically a redirection at filesystem level, effectively “hiding” the contents of the native <strong>system32</strong> and of some other folders.</paragraph>
            <paragraph>To access all the files, you have to disable this redirection in the thread where you call <literal>abc_file_check_file</literal> or <literal>abc_file_check_files</literal> (see <reference name="Wow64DisableWow64FsRedirection" refuri="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365743(v=vs.85).aspx">Wow64DisableWow64FsRedirection</reference><target ids="wow64disablewow64fsredirection" names="wow64disablewow64fsredirection" refuri="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365743(v=vs.85).aspx"></target>   ). For the upload threads, this is performed automatically.</paragraph>
        </section>
        <section ids="retrying" names="retrying">
            <title>Retrying</title>
            <paragraph>There are cases in which you should keep retrying to scan a file, for example when you get the status <strong>IN_PROGRESS</strong> for a file. This status means that someone uploaded that file and it is being analyzed in the cloud. In this case, you should use the returned <strong>ttl</strong> value as a "retry after ttl seconds" measure. Likewise, if your application itself uploads a file, the same process applies. Limits should be set for the number of retries, for the maximum <strong>ttl</strong> value to be taken into consideration (for example, "do not retry after 1 week, if ttl says so"), etc.</paragraph>
        </section>
    </section>
</document>
